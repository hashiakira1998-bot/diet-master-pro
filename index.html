<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="theme-color" content="#f4f4f2"/>
<title>Diet Logic Pro Ver 1.1</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Playfair+Display:wght@700&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html{height:100%;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}
body{height:100%;font-family:'DM Mono',monospace;background:#f4f4f2;overscroll-behavior:none;-webkit-font-smoothing:antialiased}
#root{height:100%}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:#f4f4f2}
::-webkit-scrollbar-thumb{background:#ccc;border-radius:2px}
input[type=number]::-webkit-inner-spin-button{opacity:0}
input:focus,select:focus,textarea:focus{outline:none;border-color:#1a1a1a!important}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.fu{animation:fadeUp .35s ease forwards}
.nb{background:none;border:none;cursor:pointer;font-family:'DM Mono',monospace;letter-spacing:3px;font-size:9px;padding:6px 12px;transition:color .15s}
.nb:hover{color:#1a1a1a!important}
@supports(padding:env(safe-area-inset-bottom)){
  .safe-b{padding-bottom:calc(8px + env(safe-area-inset-bottom))}
}
</style>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useRef,useEffect}=React;

/* â•â•â• localStorage helpers â•â•â• */
const LS_KEY="dlp_state";
const loadLS=()=>{try{const s=localStorage.getItem(LS_KEY);return s?JSON.parse(s):null;}catch(e){return null;}};
const saveLS=(obj)=>{try{localStorage.setItem(LS_KEY,JSON.stringify(obj));}catch(e){}};

/* â•â•â• UTILITIES â•â•â• */
const calcBMR=(w,h,a,s)=>s==="male"?10*w+6.25*h-5*a+5:10*w+6.25*h-5*a-161;
const ACT={sedentary:{label:"åº§ä½ä¸­å¿ƒ",factor:1.2},light:{label:"è»½åº¦æ´»å‹•",factor:1.375},moderate:{label:"ä¸­ç¨‹åº¦",factor:1.55},active:{label:"é«˜åº¦æ´»å‹•",factor:1.725},veryActive:{label:"è¶…é«˜åº¦",factor:1.9}};
const calcTDEE=(bmr,act)=>bmr*(ACT[act]?.factor??1.55);
const calcPFC=(tdee,goal,lean,pPct=30,fPct=25,custom="")=>{let cal=tdee;if(goal==="cut")cal=tdee-500;else if(goal==="bulk")cal=tdee+300;else if(goal==="custom"&&custom){const n=parseFloat(custom);if(!isNaN(n))cal=tdee+n;}const p=pPct?(cal*pPct)/100/4:lean?lean*2.2:(cal*0.3)/4;const f=fPct?(cal*fPct)/100/9:(cal*0.25)/9;const c=Math.max(0,(cal-p*4-f*9)/4);return{calories:Math.round(cal),protein:Math.round(p),fat:Math.round(f),carbs:Math.round(c)};};
const calcBMI=(w,h)=>w/((h/100)**2);
const parseDate=(ds)=>{if(!ds||typeof ds!=="string")return new Date();const p=ds.split("/");if(p.length===3){const d=new Date(parseInt(p[0]),parseInt(p[1])-1,parseInt(p[2]));return isNaN(d)?new Date():d;}const[m,d]=p;const y=new Date().getFullYear();const dt=new Date(y,parseInt(m)-1,parseInt(d));if(isNaN(dt))return new Date();if(dt>new Date())dt.setFullYear(y-1);return dt;};
const parseISO=(s)=>{const d=new Date(s);return isNaN(d)?new Date():d;};
const daysBtwn=(a,b)=>Math.round((b-a)/86400000);
const getWeekRange=(date)=>{const d=new Date(date);const day=d.getDay();const sun=new Date(d);sun.setDate(d.getDate()-day);const sat=new Date(sun);sat.setDate(sun.getDate()+6);return{start:sun,end:sat};};
const fmtDS=(d)=>`${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")}`;
const fmtShort=(ds)=>{if(!ds)return"";const p=ds.split("/");return p.length===3?p[1]+"/"+p[2]:ds;};

const MOCK=[{date:"2026/01/26",weight:77.0,fat:22.5,hicarb:false},{date:"2026/01/27",weight:76.8,fat:22.4,hicarb:false},{date:"2026/01/28",weight:76.6,fat:22.3,hicarb:false},{date:"2026/01/29",weight:null,fat:null,hicarb:false},{date:"2026/01/30",weight:76.5,fat:22.2,hicarb:false},{date:"2026/01/31",weight:76.3,fat:22.1,hicarb:false},{date:"2026/02/01",weight:76.2,fat:22.1,hicarb:false},{date:"2026/02/02",weight:76.0,fat:22.0,hicarb:false},{date:"2026/02/03",weight:75.8,fat:21.8,hicarb:false},{date:"2026/02/04",weight:null,fat:null,hicarb:false},{date:"2026/02/05",weight:75.6,fat:21.7,hicarb:false},{date:"2026/02/06",weight:75.5,fat:21.6,hicarb:false},{date:"2026/02/07",weight:75.4,fat:21.5,hicarb:false},{date:"2026/02/08",weight:75.3,fat:21.4,hicarb:true},{date:"2026/02/09",weight:75.1,fat:21.2,hicarb:false},{date:"2026/02/10",weight:75.0,fat:21.1,hicarb:false},{date:"2026/02/11",weight:null,fat:null,hicarb:false},{date:"2026/02/12",weight:74.9,fat:21.0,hicarb:false},{date:"2026/02/13",weight:74.8,fat:21.0,hicarb:false},{date:"2026/02/14",weight:74.7,fat:20.9,hicarb:false},{date:"2026/02/15",weight:74.5,fat:20.8,hicarb:false},{date:"2026/02/16",weight:74.4,fat:20.7,hicarb:false},{date:"2026/02/17",weight:74.2,fat:20.5,hicarb:false},{date:"2026/02/18",weight:74.1,fat:20.4,hicarb:false},{date:"2026/02/19",weight:74.0,fat:20.3,hicarb:false}];

const ADVICE_MSGS={yellow:["âš ï¸ ä½“é‡ãŒå‡è¡¡ã—ã¦ã„ã¾ã™ã€‚NEATï¼ˆéé‹å‹•æ€§æ´»å‹•ç†±ç”£ç”Ÿï¼‰ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚","âš ï¸ ãƒšãƒ¼ã‚¹ãŒéˆåŒ–ã—ã¦ã„ã¾ã™ã€‚å¡©åˆ†æ‘‚å–ã«ã‚ˆã‚‹æ°´åˆ†ä¿æŒã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ãŒã€PFCã®å†ç¢ºèªã‚’æ¨å¥¨ã—ã¾ã™ã€‚","âš ï¸ 2é€±é€£ç¶šã§ç†æƒ³ãƒšãƒ¼ã‚¹ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™ã€‚é£Ÿäº‹ãƒ­ã‚°ã®è¦‹ç›´ã—ã€éš ã‚Œã‚«ãƒ­ãƒªãƒ¼ã‚’å†ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚","âš ï¸ ãƒšãƒ¼ã‚¹éˆåŒ–ãŒç¶šã„ã¦ã„ã¾ã™ã€‚æœ‰é…¸ç´ ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’15ã€œ20åˆ†è¿½åŠ ã™ã‚‹æ¤œè¨ã‚‚æœ‰åŠ¹ã§ã™ã€‚","âš ï¸ 3é€±ä»¥ä¸Šãƒšãƒ¼ã‚¹ãŒéˆåŒ–ã€‚2ã€œ3æ—¥ã®ãƒªãƒ•ã‚£ãƒ¼ãƒ‰ã‚’æŒŸã‚“ã§ä»£è¬ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ã‚‡ã†ã€‚","âš ï¸ é•·æœŸåœæ»ã€‚ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ–ãƒ¬ã‚¤ã‚¯ï¼ˆ1ã€œ2é€±é–“ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼‰ã‚’å®Ÿæ–½ã—ã€ãƒ›ãƒ«ãƒ¢ãƒ³ãƒãƒ©ãƒ³ã‚¹ã®å›å¾©ã‚’æ¨å¥¨ã—ã¾ã™ã€‚"],red:["ğŸ›‘ ç†è«–å€¤ã¨ã®ä¹–é›¢ãŒæ‹¡å¤§ã€‚5-10%ã®ã‚«ãƒ­ãƒªãƒ¼èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚","ğŸ›‘ ä»£è¬é©å¿œã®å¯èƒ½æ€§ã€‚ãƒªãƒ•ã‚£ãƒ¼ãƒ‰ï¼ˆãƒã‚¤ã‚«ãƒ¼ãƒœï¼‰ã‚’å…¥ã‚Œã¦ä»£è¬ã«åˆºæ¿€ã‚’ã€‚","ğŸ›‘ 2é€±é€£ç¶šã®è­¦å‘Šã€‚PFCãƒãƒ©ãƒ³ã‚¹ã®å†è¨ˆç®—ã¨é£Ÿäº‹è¨˜éŒ²ã®æ­£ç¢ºæ€§ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚","ğŸ›‘ TDEEã®æ´»å‹•ãƒ¬ãƒ™ãƒ«è¨­å®šãŒå®Ÿæ…‹ã¨åˆã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚","ğŸ›‘ 3é€±ä»¥ä¸Šã®è­¦å‘Šã€‚ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ–ãƒ¬ã‚¤ã‚¯ã‚’å–ã‚Šå†é–‹ãƒ—ãƒ©ãƒ³ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚","ğŸ›‘ æ·±åˆ»ãªåœæ»ã€‚å°‚é–€å®¶ã¸ã®ç›¸è«‡ã‚’æ¨å¥¨ã—ã¾ã™ã€‚"]};

const EMPTY_MEALS=[{label:"èµ·åºŠå¾Œ",labelEn:"WAKING UP",desc:"",p:"",f:"",c:""},{label:"æœã”é£¯",labelEn:"MORNING",desc:"",p:"",f:"",c:""},{label:"æ˜¼ã”é£¯",labelEn:"LUNCH",desc:"",p:"",f:"",c:""},{label:"æ™©ã”é£¯",labelEn:"DINNER",desc:"",p:"",f:"",c:""},{label:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",labelEn:"WORKOUT",desc:"",p:"",f:"",c:""},{label:"å°±å¯å‰",labelEn:"PRE-BED",desc:"",p:"",f:"",c:""},{label:"ãã®ä»–1",labelEn:"OTHER 1",desc:"",p:"",f:"",c:"",editable:true},{label:"ãã®ä»–2",labelEn:"OTHER 2",desc:"",p:"",f:"",c:"",editable:true},{label:"ãã®ä»–3",labelEn:"OTHER 3",desc:"",p:"",f:"",c:"",editable:true}];

/* â•â•â• COMPONENTS â•â•â• */
function TrendChart({data,mode,onClickDate,goalLine,issnLine,showLines,showIssn=true,chartId="main"}){
  if(!data||!data.length)return(<div style={{height:180,display:"flex",alignItems:"center",justifyContent:"center",color:"#bbb",fontSize:11}}>ãƒ‡ãƒ¼ã‚¿ãªã—</div>);
  const label=mode==="weight"?"weight":"fat",unit=mode==="weight"?"kg":"%",step=mode==="weight"?1:0.5,lineColor=mode==="weight"?"#1a1a1a":"#5a7a5a";
  const scrollRef=useRef(null);
  const vals=data.map(d=>d[label]),filled=[];let last=null;
  vals.forEach(v=>{if(v!==null){last=v;filled.push(v);}else filled.push(last);});
  const nonNull=filled.filter(v=>v!==null);
  if(!nonNull.length)return(<div style={{height:180,display:"flex",alignItems:"center",justifyContent:"center",color:"#bbb",fontSize:11}}>ãƒ‡ãƒ¼ã‚¿ãªã—</div>);
  const actualMin=Math.min(...nonNull),actualMax=Math.max(...nonNull);
  const actualCenter=(actualMin+actualMax)/2;
  let rangeMin=actualMin,rangeMax=actualMax;
  if(showLines){const allLineVals=[];if(goalLine)goalLine.forEach(v=>{if(v>=actualCenter-5&&v<=actualCenter+5)allLineVals.push(v);});if(showIssn&&issnLine)issnLine.forEach(v=>{if(v>=actualCenter-5&&v<=actualCenter+5)allLineVals.push(v);});if(allLineVals.length){rangeMin=Math.min(rangeMin,...allLineVals);rangeMax=Math.max(rangeMax,...allLineVals);}}
  const axisMin=+(Math.floor(rangeMin/step)*step-step).toFixed(2);
  const axisMax=+(Math.ceil(rangeMax/step)*step+step).toFixed(2);
  const axisRange=axisMax-axisMin||1;
  const YAXIS_W=38,PAD_T=26,PAD_B=34,PAD_R=10,COL_W=52,CHART_H=140;
  const H=PAD_T+CHART_H+PAD_B,SCROLL_W=COL_W*data.length+PAD_R;
  const toX=i=>COL_W*i+COL_W/2;
  const toY=v=>PAD_T+CHART_H-((v-axisMin)/axisRange)*CHART_H;
  const pts=filled.map((v,i)=>`${toX(i)},${toY(v)}`);
  const yLabels=[];for(let v=axisMin;v<=axisMax+0.001;v=+(v+step).toFixed(2))yLabels.push(+v.toFixed(2));
  const getYear=(ds)=>{const p=ds.split("/");return p.length===3?p[0]:"";};
  const clipTop=PAD_T,clipHeight=CHART_H;
  const mkPts=(arr)=>arr?arr.map((w,i)=>`${toX(i)},${toY(w)}`).join(" "):"";
  return(
    <div style={{display:"flex",gap:0,userSelect:"none"}}>
      <svg width={YAXIS_W} height={H} style={{flexShrink:0,display:"block"}}>{yLabels.map((v,i)=>{const y=toY(v);return(<g key={i}><line x1={YAXIS_W-4} y1={y} x2={YAXIS_W} y2={y} stroke="#e0e0de" strokeWidth="1"/><text x={YAXIS_W-6} y={y+4} textAnchor="end" fontSize="9" fill="#9a9a9a" fontFamily="'DM Mono',monospace">{v.toFixed(1)}</text></g>);})}</svg>
      <div ref={scrollRef} style={{flex:1,overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch",cursor:"grab"}} onMouseDown={e=>{const el=scrollRef.current;let sX=e.pageX-el.offsetLeft,sL=el.scrollLeft;const mv=ev=>{el.scrollLeft=sL-(ev.pageX-el.offsetLeft-sX);};const up=()=>{window.removeEventListener("mousemove",mv);window.removeEventListener("mouseup",up);};window.addEventListener("mousemove",mv);window.addEventListener("mouseup",up);}} onTouchStart={e=>{const el=scrollRef.current;const sX=e.touches[0].pageX;const sL=el.scrollLeft;const mv=ev=>{el.scrollLeft=sL-(ev.touches[0].pageX-sX);};const up=()=>{el.removeEventListener("touchmove",mv);el.removeEventListener("touchend",up);};el.addEventListener("touchmove",mv,{passive:true});el.addEventListener("touchend",up);}}>
        <svg width={SCROLL_W} height={H} style={{display:"block",minWidth:SCROLL_W}}>
          <defs><linearGradient id={`tg-${chartId}-${mode}`} x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor={lineColor} stopOpacity="0.12"/><stop offset="100%" stopColor={lineColor} stopOpacity="0"/></linearGradient><clipPath id={`cClip-${chartId}`}><rect x="0" y={clipTop} width={SCROLL_W} height={clipHeight}/></clipPath></defs>
          {yLabels.map((v,i)=>(<line key={i} x1={0} y1={toY(v)} x2={SCROLL_W} y2={toY(v)} stroke="#ebebea" strokeWidth="1"/>))}
          {showLines&&showIssn&&issnLine&&issnLine.length>0&&(<polyline clipPath={`url(#cClip-${chartId})`} points={mkPts(issnLine)} fill="none" stroke="#ff9f40" strokeWidth="2" strokeDasharray="3 3"/>)}
          {showLines&&goalLine&&goalLine.length>0&&(<polyline clipPath={`url(#cClip-${chartId})`} points={mkPts(goalLine)} fill="none" stroke="#6bcf7f" strokeWidth="2" strokeDasharray="4 2"/>)}
          <polygon points={`${toX(0)},${PAD_T+CHART_H} ${pts.join(" ")} ${toX(data.length-1)},${PAD_T+CHART_H}`} fill={`url(#tg-${chartId}-${mode})`}/>
          <polyline points={pts.join(" ")} fill="none" stroke={lineColor} strokeWidth="2" strokeLinejoin="round"/>
          {data.map((d,i)=>{const v=d[label],fv=filled[i],cx=toX(i),cy=toY(fv),has=v!==null;return(
            <g key={i} style={{cursor:has?"pointer":"default"}} onClick={()=>has&&onClickDate&&onClickDate(d)}>
              <rect x={cx-26} y={H-PAD_B} width={52} height={PAD_B} fill="transparent"/><text x={cx} y={H-16} textAnchor="middle" fontSize="8" fill={has?"#2a2a2a":"#ccc"} fontFamily="'DM Mono',monospace" fontWeight={has?"600":"400"}>{fmtShort(d.date)}</text>{(i===0||getYear(d.date)!==(i>0?getYear(data[i-1].date):""))&&(<text x={cx} y={H-5} textAnchor="middle" fontSize="7" fill="#f4a261" fontFamily="'DM Mono',monospace" fontWeight="700">{getYear(d.date)}</text>)}
              <circle cx={cx} cy={cy} r={has?4:3} fill="#fff" stroke={has?lineColor:"#ccc"} strokeWidth="2"/>{has&&(<text x={cx} y={cy-10} textAnchor="middle" fontSize="8" fontWeight="700" fill={lineColor} fontFamily="'DM Mono',monospace">{v.toFixed(1)}</text>)}{d.hicarb&&(<text x={cx} y={cy+16} textAnchor="middle" fontSize="7" fontWeight="700" fill="#ff6b35" fontFamily="'DM Mono',monospace">HC</text>)}
            </g>);})}
          {showLines&&(<g transform={`translate(${SCROLL_W-70},${PAD_T+4})`}><rect x="-6" y="-8" width="72" height={showIssn?72:52} rx="4" fill="rgba(255,255,255,0.85)"/><line x1="0" y1="4" x2="20" y2="4" stroke="#1a1a1a" strokeWidth="2"/><text x="24" y="8" fontSize="7" fill="#1a1a1a" fontWeight="600" fontFamily="'DM Mono',monospace">å®Ÿæ¸¬</text><line x1="0" y1="22" x2="20" y2="22" stroke="#6bcf7f" strokeWidth="2" strokeDasharray="4 2"/><text x="24" y="26" fontSize="7" fill="#6bcf7f" fontWeight="600" fontFamily="'DM Mono',monospace">ç›®æ¨™</text>{showIssn&&(<><line x1="0" y1="40" x2="20" y2="40" stroke="#ff9f40" strokeWidth="2" strokeDasharray="3 3"/><text x="24" y="44" fontSize="7" fill="#ff9f40" fontWeight="600" fontFamily="'DM Mono',monospace">ISSN</text></>)}</g>)}
        </svg>
      </div>
    </div>);
}

function MacroRing({protein,fat,carbs}){const t=protein*4+fat*9+carbs*4;if(!t)return null;const pP=(protein*4)/t,pF=(fat*9)/t;const R=48,cx=56,cy=56,sw=11,circ=2*Math.PI*R;const segs=[{pct:pP,c:"#1a1a1a"},{pct:pF,c:"#6a6a6a"},{pct:1-pP-pF,c:"#c8c8c6"}];let off=0;return(<svg width="112" height="112" style={{flexShrink:0}}><circle cx={cx} cy={cy} r={R} fill="none" stroke="#ebebea" strokeWidth={sw}/>{segs.map((s,i)=>{const dash=s.pct*circ;const el=(<circle key={i} cx={cx} cy={cy} r={R} fill="none" stroke={s.c} strokeWidth={sw} strokeDasharray={`${dash} ${circ-dash}`} strokeDashoffset={-off*circ} style={{transform:"rotate(-90deg)",transformOrigin:`${cx}px ${cy}px`}}/>);off+=s.pct;return el;})}<text x={cx} y={cy-5} textAnchor="middle" fill="#1a1a1a" fontSize="13" fontWeight="600" fontFamily="'DM Mono',monospace">{Math.round(t)}</text><text x={cx} y={cy+11} textAnchor="middle" fill="#6a6a6a" fontSize="9" fontFamily="'DM Mono',monospace">kcal</text></svg>);}

const Card=({children,style={}})=>(<div style={{background:"#fff",border:"1px solid #e0e0de",borderRadius:6,padding:"20px 22px",...style}}>{children}</div>);
const SL=({children})=>(<p style={{fontSize:9,letterSpacing:4,color:"#8a8a8a",fontWeight:500,marginBottom:16}}>{children}</p>);
const Modal=({children,onClose})=>(<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.28)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16}} onClick={onClose}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:8,padding:"24px 22px",width:"100%",maxWidth:540,boxShadow:"0 8px 40px rgba(0,0,0,0.15)",maxHeight:"90vh",overflowY:"auto"}}>{children}</div></div>);

function MiniCal({onSel,sel}){
  const today=new Date();
  const[curY,setCurY]=useState(today.getFullYear());
  const[curM,setCurM]=useState(today.getMonth());
  const fd=new Date(curY,curM,1).getDay();
  const dim=new Date(curY,curM+1,0).getDate();
  const cells=[...Array(fd).fill(null),...Array.from({length:dim},(_,i)=>i+1)];
  const MN=["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"];
  const DN=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  const goPrev=()=>{if(curM===0){setCurY(y=>y-1);setCurM(11);}else{setCurM(m=>m-1);}};
  const goNext=()=>{if(curM===11){setCurY(y=>y+1);setCurM(0);}else{setCurM(m=>m+1);}};
  return(<div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
      <button type="button" onClick={goPrev} style={{background:"none",border:"none",cursor:"pointer",fontSize:18,color:"#3a3a3a",lineHeight:1}}>â€¹</button>
      <span style={{fontSize:12,fontWeight:700,color:"#1a1a1a",fontFamily:"'DM Mono',monospace"}}>{curY}å¹´ {MN[curM]}</span>
      <button type="button" onClick={goNext} style={{background:"none",border:"none",cursor:"pointer",fontSize:18,color:"#3a3a3a",lineHeight:1}}>â€º</button>
    </div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:4}}>{DN.map(d=>(<div key={d} style={{textAlign:"center",fontSize:9,color:"#9a9a9a",fontWeight:600,padding:"3px 0"}}>{d}</div>))}</div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2}}>{cells.map((d,i)=>{
      if(!d)return <div key={i}/>;
      const ds=`${curY}/${String(curM+1).padStart(2,"0")}/${String(d).padStart(2,"0")}`;
      const cellDate=new Date(curY,curM,d);
      const isFut=cellDate>today;
      const isSel=sel===ds;
      return(<button key={i} type="button" disabled={isFut} onClick={()=>onSel(ds)} style={{background:isSel?"#1a1a1a":"none",color:isSel?"#fff":isFut?"#ccc":"#1a1a1a",border:"none",borderRadius:4,padding:"7px 0",cursor:isFut?"default":"pointer",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:600}}>{d}</button>);
    })}</div>
  </div>);
}

/* â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â• */
function App(){
  /* Load saved state or use defaults */
  const saved=loadLS();
  const D=saved||{};
  const[prof,setProf]=useState(D.prof||{height:"170",age:"30",sex:"male",activity:"moderate",goal:"cut",goalCustom:""});
  const[tw,setTw]=useState(""),[tf,setTf]=useState("");
  const[data,setData]=useState(D.data||MOCK);
  const[calcMode,setCalcMode]=useState(D.calcMode||"auto");
  const[manual,setManual]=useState(D.manual||{calories:"2000",protein:"150",fat:"55",carbs:"220"});
  const[manualExtra,setManualExtra]=useState(D.manualExtra||[{label:"ãã®ä»–1",p:"",f:"",c:""},{label:"ãã®ä»–2",p:"",f:"",c:""}]);
  const[tab,setTab]=useState("dashboard");
  const[supps,setSupps]=useState(D.supps||{pre:"ã‚¯ãƒ¬ã‚¢ãƒãƒ³ 5g / ã‚«ãƒ•ã‚§ã‚¤ãƒ³ 200mg",during:"EAA 15g / ã‚¯ã‚¨ãƒ³é…¸ â—‹g",post:"ãƒ›ã‚¨ã‚¤ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ 30g / ã‚°ãƒ«ã‚¿ãƒŸãƒ³ 6g",bed:"äºœé‰› 10g / ãƒã‚°ãƒã‚·ã‚¦ãƒ  150mg"});
  const[reminder,setReminder]=useState(D.reminder||false);
  const[startWeight,setStartWeight]=useState(D.startWeight||"77.0");
  const[gw,setGw]=useState(D.gw??70),[gd,setGd]=useState(D.gd||"2026-04-01"),[startDate,setStartDate]=useState(D.startDate||"2026-01-01");
  const[chart,setChart]=useState("weight");
  const[mCloth,setMCloth]=useState(false),[mEdit,setMEdit]=useState(false),[mCal,setMCal]=useState(false);
  const[mMealSet,setMMealSet]=useState(false),[mDelConfirm,setMDelConfirm]=useState(false),[mResetConfirm,setMResetConfirm]=useState(false);
  const[editTgt,setEditTgt]=useState(null),[calDate,setCalDate]=useState(""),[calW,setCalW]=useState(""),[calF,setCalF]=useState("");
  const[cloth,setCloth]=useState(D.cloth||[{name:"ã‚¸ãƒ ç€ï¼ˆT+ã‚·ãƒ§ãƒ¼ãƒ„ï¼‰",gram:"300"},{name:"ä»•äº‹ç€ï¼ˆã‚¹ãƒ¼ãƒ„ï¼‰",gram:"1500"},{name:"ãƒ‘ã‚¸ãƒ£ãƒ",gram:"200"},{name:"ã‚¹ã‚¦ã‚§ãƒƒãƒˆä¸Šä¸‹",gram:"600"},{name:"ã‚«ã‚¹ã‚¿ãƒ 5",gram:""}]);
  const[pfcPct,setPfcPct]=useState(D.pfcPct||{p:"",f:"",c:""});
  const pfcSum=(pfcPct.p?parseFloat(pfcPct.p):0)+(pfcPct.f?parseFloat(pfcPct.f):0)+(pfcPct.c?parseFloat(pfcPct.c):0);
  const pfcFilled=pfcPct.p!==""&&pfcPct.f!==""&&pfcPct.c!=="";
  const pfcErr=pfcFilled&&Math.abs(pfcSum-100)>0.01;
  const[mealSets,setMealSets]=useState(D.mealSets||[{title:"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ",meals:JSON.parse(JSON.stringify(EMPTY_MEALS))}]);
  const[curSetIdx,setCurSetIdx]=useState(0);
  const[delTgtIdx,setDelTgtIdx]=useState(null),[resetTgtIdx,setResetTgtIdx]=useState(null);
  const[hicarbDays,setHicarbDays]=useState(D.hicarbDays??1);
  const resetHicarb=()=>{setHicarbDays(1);const n=new Date();const ds=`${n.getFullYear()}/${String(n.getMonth()+1).padStart(2,"0")}/${String(n.getDate()).padStart(2,"0")}`;setData(prev=>prev.map(d=>(d.date===ds?{...d,hicarb:true}:d)));};
  const[paceMode,setPaceMode]=useState(D.paceMode||"auto"),[customPace,setCustomPace]=useState(D.customPace||"0.75"),[customDirection,setCustomDirection]=useState(D.customDirection||"cut");
  const[consecutiveYellow]=useState(0),[consecutiveRed]=useState(0);
  const[semiMeals,setSemiMeals]=useState(D.semiMeals||[{label:"æœã”é£¯",labelEn:"MORNING",p:"",f:"",c:"",locked:true},{label:"æ˜¼ã”é£¯",labelEn:"LUNCH",p:"",f:"",c:"",locked:true},{label:"æ™©ã”é£¯",labelEn:"DINNER",p:"",f:"",c:"",locked:true},{label:"ãã®ä»–1",labelEn:"OTHER 1",p:"",f:"",c:"",locked:true},{label:"ãã®ä»–2",labelEn:"OTHER 2",p:"",f:"",c:"",locked:true}]);
  const[weekOffset,setWeekOffset]=useState(0);

  /* â•â•â• AUTO-SAVE on every state change â•â•â• */
  useEffect(()=>{
    saveLS({prof,data,calcMode,manual,manualExtra,supps,reminder,startWeight,gw,gd,startDate,cloth,pfcPct,mealSets,hicarbDays,paceMode,customPace,customDirection,semiMeals});
  },[prof,data,calcMode,manual,manualExtra,supps,reminder,startWeight,gw,gd,startDate,cloth,pfcPct,mealSets,hicarbDays,paceMode,customPace,customDirection,semiMeals]);

  const record=(ds,w,f,hc)=>{const wv=w!==""&&w!=null?parseFloat(w):null;const fv=f!==""&&f!=null?parseFloat(f):null;setData(prev=>{const ex=prev.findIndex(d=>d.date===ds);if(ex>=0){const n=[...prev];n[ex]={...n[ex],weight:wv??n[ex].weight,fat:fv??n[ex].fat,hicarb:hc!==undefined?hc:n[ex].hicarb};return n;}return[...prev,{date:ds,weight:wv,fat:fv,hicarb:hc||false}].sort((a,b)=>a.date.localeCompare(b.date));});};

  const latest=[...data].reverse().find(d=>d.weight!==null);
  const W=latest?.weight??75,FP=latest?.fat??20;
  const lean=W*(1-FP/100);
  const heightNum=parseFloat(prof.height)||170,ageNum=parseFloat(prof.age)||30;
  const bmr=calcBMR(W,heightNum,ageNum,prof.sex);
  const tdee=calcTDEE(bmr,prof.activity);
  const pP=pfcPct.p?parseFloat(pfcPct.p):null,fPr=pfcPct.f?parseFloat(pfcPct.f):null,cP=pfcPct.c?parseFloat(pfcPct.c):null;
  const aFC=calcPFC(tdee,prof.goal,lean,pP&&fPr&&cP?pP:30,pP&&fPr&&cP?fPr:25,prof.goalCustom);
  const mealTarget={protein:Math.round(aFC.protein/3),fat:Math.round(aFC.fat/3),carbs:Math.round(aFC.carbs/3)};
  const computeSemiMeals=()=>semiMeals.map((m,i)=>{const isMain=i<3;const p=m.locked?(isMain?mealTarget.protein:0):(parseFloat(m.p)||0);const f=m.locked?(isMain?mealTarget.fat:0):(parseFloat(m.f)||0);const c=m.locked?(isMain?mealTarget.carbs:0):(parseFloat(m.c)||0);return{...m,cp:p,cf:f,cc:c,cal:Math.round(p*4+f*9+c*4)};});
  const semiComputed=computeSemiMeals();
  const semiTotal={protein:semiComputed.reduce((s,m)=>s+m.cp,0),fat:semiComputed.reduce((s,m)=>s+m.cf,0),carbs:semiComputed.reduce((s,m)=>s+m.cc,0),calories:semiComputed.reduce((s,m)=>s+m.cal,0)};
  const computeActiveCalories=()=>{if(calcMode==="auto")return aFC;if(calcMode==="manual"){let p=parseFloat(manual.protein)||0,f=parseFloat(manual.fat)||0,c=parseFloat(manual.carbs)||0;manualExtra.forEach(ex=>{p+=parseFloat(ex.p)||0;f+=parseFloat(ex.f)||0;c+=parseFloat(ex.c)||0;});return{calories:Math.round(p*4+f*9+c*4),protein:p,fat:f,carbs:c};}return semiTotal;};
  const aPFC=computeActiveCalories();
  const computeMealSetTotals=()=>{if(!mealSets[curSetIdx])return{p:0,f:0,c:0,cal:0};let tp=0,tf2=0,tc=0;mealSets[curSetIdx].meals.forEach(m=>{tp+=parseFloat(m.p)||0;tf2+=parseFloat(m.f)||0;tc+=parseFloat(m.c)||0;});return{p:tp,f:tf2,c:tc,cal:Math.round(tp*4+tf2*9+tc*4)};};
  const mealSetTotals=computeMealSetTotals();
  const bodyFatKg=+(W*FP/100).toFixed(1),leanMass=+(W-bodyFatKg).toFixed(1);
  const pfcTotal=aPFC.protein*4+aPFC.fat*9+aPFC.carbs*4;
  const pfcBalance=pfcTotal>0?{p:((aPFC.protein*4/pfcTotal)*100).toFixed(0),f:((aPFC.fat*9/pfcTotal)*100).toFixed(0),c:((aPFC.carbs*4/pfcTotal)*100).toFixed(0)}:{p:"0",f:"0",c:"0"};

  const SW=parseFloat(startWeight)||W;
  const TW=gw;
  const sdObj=parseISO(startDate),tdObj=parseISO(gd);
  const totalDays=Math.max(1,daysBtwn(sdObj,tdObj));
  const dailySlope=(TW-SW)/totalDays;
  const totalLoss=SW-TW;
  const lossPerMonth=(totalLoss/(totalDays/30)).toFixed(2);
  const lossPerWeek=(totalLoss/(totalDays/7)).toFixed(2);

  const computeGoalLine=(arr)=>{
    if(paceMode==="custom"){const pv=parseFloat(customPace)||0.75;const sign=customDirection==="cut"?-1:1;const dp=(pv/7)*sign;return arr.map(d=>{const dDate=parseDate(d.date);const dfs=daysBtwn(sdObj,dDate);return SW+dp*dfs;});}
    return arr.map(d=>{const dDate=parseDate(d.date);const dfs=daysBtwn(sdObj,dDate);return SW+dailySlope*dfs;});
  };
  const computeIssnLine=(arr)=>{
    return arr.map(d=>{const dDate=parseDate(d.date);const dfs=daysBtwn(sdObj,dDate);let cw=SW;for(let dd=0;dd<Math.max(0,dfs);dd++){const bmi=calcBMI(cw,heightNum);cw-=(bmi>=25?0.75:0.5)/7;}return cw;});
  };
  const goalWeightsFull=computeGoalLine(data);
  const issnWeightsFull=computeIssnLine(data);
  const showIssnLine=!(paceMode==="custom"&&customDirection==="bulk");

  const getCurrentTargetPace=()=>{const bmi=calcBMI(W,heightNum);if(paceMode==="auto")return bmi>=25?0.75:0.5;return parseFloat(customPace)||0.75;};
  const getWeekData=(offset)=>{const today=new Date();const refDate=new Date(today);refDate.setDate(today.getDate()+offset*7);const{start,end}=getWeekRange(refDate);const startStr=fmtDS(start),endStr=fmtDS(end);const weekData=data.filter(d=>d.date>=startStr&&d.date<=endStr);return{start,end,startStr,endStr,data:weekData};};
  const getWeeklyAdvice=(weekData)=>{const sorted=weekData.filter(d=>d.weight!==null).sort((a,b)=>a.date.localeCompare(b.date));if(sorted.length<2)return{color:"green",msg:"âœ… ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ä¸­ã§ã™ã€‚è¨˜éŒ²ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚",actualPace:null};const first=sorted[0].weight,lastt=sorted[sorted.length-1].weight;const db=Math.max(1,sorted.length-1);const actualPace=((first-lastt)/db)*7;const targetPace=getCurrentTargetPace();if(actualPace>=targetPace)return{color:"green",msg:"âœ… ç†è«–é€šã‚Šã®ãƒšãƒ¼ã‚¹ã§ã™ã€‚ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚",actualPace};if(actualPace>=targetPace*0.66){const wk=Math.min(consecutiveYellow,5);let idx;if(wk<1)idx=Math.floor(Math.random()*2);else if(wk<2)idx=2+Math.floor(Math.random()*2);else idx=Math.min(4+(wk-2),5);return{color:"yellow",msg:ADVICE_MSGS.yellow[idx],actualPace};}const wk=Math.min(consecutiveRed,5);let idx;if(wk<1)idx=Math.floor(Math.random()*2);else if(wk<2)idx=2+Math.floor(Math.random()*2);else idx=Math.min(4+(wk-2),5);return{color:"red",msg:ADVICE_MSGS.red[idx],actualPace};};
  const currentWeek=getWeekData(weekOffset);
  const wkD=currentWeek.data.length>0?currentWeek.data:[{date:fmtDS(currentWeek.start),weight:null,fat:null,hicarb:false}];
  const weekGoalLine=computeGoalLine(wkD);
  const weekIssnLine=computeIssnLine(wkD);
  const advice=getWeeklyAdvice(currentWeek.data);

  const IB={fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:500,color:"#1a1a1a",background:"#f8f8f6",border:"1px solid #e0e0de",borderRadius:4,padding:"8px 12px",width:"100%",outline:"none"};
  const BP={fontFamily:"'DM Mono',monospace",background:"#1a1a1a",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:600};
  const BS={fontFamily:"'DM Mono',monospace",background:"#fff",color:"#3a3a3a",border:"1px solid #d0d0ce",borderRadius:4,cursor:"pointer",fontWeight:600};

  const TABS=[{id:"dashboard",l:"DASH"},{id:"calc",l:"CALC"},{id:"supps",l:"SUPPS"},{id:"advisor",l:"ADVISOR"}];

  return(
    <div style={{maxWidth:540,margin:"0 auto",minHeight:"100%",display:"flex",flexDirection:"column",background:"#f4f4f2"}}>
      {/* HEADER */}
      <header style={{background:"#1a1a1a",padding:"18px 22px 14px",flexShrink:0}}>
        <h1 style={{fontFamily:"'Playfair Display',serif",fontSize:18,fontWeight:700,color:"#fff",letterSpacing:2}}>Diet Logic <span style={{color:"#6a6a6a"}}>Proã€€Ver1.1</span></h1>
        <p style={{fontSize:8,letterSpacing:6,color:"#5a5a5a",marginTop:4}}>EVIDENCE â€” BASED BODY RECOMPOSITION</p>
      </header>
      {/* TAB BAR */}
      <nav className="safe-b" style={{display:"flex",background:"#fff",borderBottom:"1px solid #e0e0de",position:"sticky",top:0,zIndex:100,flexShrink:0}}>
        {TABS.map(t=>(<button key={t.id} className="nb" onClick={()=>setTab(t.id)} style={{flex:1,padding:"14px 8px 12px",color:tab===t.id?"#1a1a1a":"#b0b0ae",fontWeight:tab===t.id?700:400,borderBottom:tab===t.id?"2px solid #1a1a1a":"2px solid transparent",transition:"all .15s"}}>{t.l}</button>))}
      </nav>
      {/* MAIN */}
      <main style={{flex:1,padding:"20px 16px 32px",overflowY:"auto",WebkitOverflowScrolling:"touch"}}>
        {/* â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â• */}
        {tab==="dashboard"&&(<div className="fu">
          {/* STATUS BAR */}
          <Card style={{marginBottom:14}}><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:10,textAlign:"center"}}>{[{l:"BMR",v:Math.round(bmr)+" kcal"},{l:"TDEE",v:Math.round(tdee)+" kcal"},{l:"BMI",v:calcBMI(W,heightNum).toFixed(1)}].map(s=>(<div key={s.l}><p style={{fontSize:8,letterSpacing:3,color:"#8a8a8a",marginBottom:4}}>{s.l}</p><p style={{fontSize:16,fontWeight:700,color:"#1a1a1a"}}>{s.v}</p></div>))}</div><div style={{borderTop:"1px solid #ebebea",marginTop:14,paddingTop:14,display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,textAlign:"center"}}>{[{l:"ä½“é‡",v:W+" kg"},{l:"ä½“è„‚è‚ª",v:FP+"%"},{l:"è„‚è‚ªé‡",v:bodyFatKg+"kg"},{l:"é™¤è„‚è‚ª",v:leanMass+"kg"}].map(s=>(<div key={s.l}><p style={{fontSize:8,color:"#aaa",marginBottom:2}}>{s.l}</p><p style={{fontSize:12,fontWeight:700,color:"#2a2a2a"}}>{s.v}</p></div>))}</div></Card>
          {/* TODAY'S LOG */}
          <Card style={{marginBottom:14}}><SL>TODAY'S LOG</SL><div style={{display:"flex",gap:10,alignItems:"flex-end"}}><div style={{flex:1}}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>ä½“é‡ (kg)</p><input type="text" inputMode="decimal" placeholder={W.toString()} value={tw} onChange={e=>setTw(e.target.value.replace(/[^0-9.]/g,""))} style={{...IB,fontSize:20,fontWeight:700,padding:"6px 10px"}}/></div><div style={{flex:1}}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>ä½“è„‚è‚ªç‡ (%)</p><input type="text" inputMode="decimal" placeholder={FP.toString()} value={tf} onChange={e=>setTf(e.target.value.replace(/[^0-9.]/g,""))} style={{...IB,fontSize:20,fontWeight:700,padding:"6px 10px"}}/></div><div style={{display:"flex",flexDirection:"column",gap:6}}><button onClick={()=>setMCloth(true)} style={{...BS,fontSize:9,letterSpacing:2,padding:"8px 14px"}}>è©³ç´°</button><button onClick={()=>{if(!tw&&!tf)return;const n=new Date();const ds=`${n.getFullYear()}/${String(n.getMonth()+1).padStart(2,"0")}/${String(n.getDate()).padStart(2,"0")}`;record(ds,tw,tf);setTw("");setTf("");}} style={{...BP,fontSize:9,letterSpacing:2,padding:"8px 14px",opacity:(tw||tf)?1:0.35}}>è¨˜éŒ²</button></div></div></Card>
          {/* WEIGHT TREND */}
          <Card style={{marginBottom:14}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><SL>{chart==="weight"?"WEIGHT TREND":"BODY FAT TREND"}</SL><div style={{display:"flex",gap:8,alignItems:"center",marginTop:-14}}><button onClick={()=>{setCalDate("");setCalW("");setCalF("");setMCal(true);}} style={{background:"none",border:"1px solid #e0e0de",borderRadius:4,padding:"4px 8px",cursor:"pointer",fontSize:14,lineHeight:1,color:"#3a3a3a"}}>ğŸ“…</button><button onClick={()=>setChart(m=>(m==="weight"?"fat":"weight"))} style={{...BS,fontSize:9,letterSpacing:2,padding:"5px 11px"}}>åˆ‡æ›ãˆ</button></div></div><TrendChart chartId="dash" data={data} mode={chart} onClickDate={d=>{if(d.weight===null&&d.fat===null)return;setEditTgt({...d});setMEdit(true);}} goalLine={chart==="weight"?goalWeightsFull:null} issnLine={chart==="weight"?issnWeightsFull:null} showLines={chart==="weight"} showIssn={showIssnLine}/><p style={{fontSize:9,color:"#bbb",marginTop:8,textAlign:"right"}}>â† ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯ ï¼ è¨˜éŒ²æ—¥ã‚’ã‚¿ãƒƒãƒ—ã§ä¿®æ­£</p></Card>
          {/* DAILY MACROS + PFC input */}
          <Card><SL>DAILY MACROS</SL><div style={{display:"flex",alignItems:"center",gap:20}}><MacroRing protein={aPFC.protein} fat={aPFC.fat} carbs={aPFC.carbs}/><div style={{flex:1}}>{[{l:"PROTEIN",v:aPFC.protein,c:"#1a1a1a"},{l:"FAT",v:aPFC.fat,c:"#6a6a6a"},{l:"CARBS",v:aPFC.carbs,c:"#b8b8b6"}].map(m=>(<div key={m.l} style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:"50%",background:m.c}}/><span style={{fontSize:9,letterSpacing:3,color:"#5a5a5a",fontWeight:600}}>{m.l}</span></div><span style={{fontSize:18,fontWeight:700,color:"#1a1a1a"}}>{m.v}<span style={{fontSize:10,color:"#8a8a8a",fontWeight:400,marginLeft:2}}>g</span></span></div>))}<div style={{borderTop:"1px solid #ebebea",paddingTop:10,display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontSize:9,letterSpacing:3,color:"#8a8a8a"}}>P:F:C BALANCE</span><span style={{fontSize:12,color:"#2a2a2a",fontWeight:700}}>{pfcBalance.p}% : {pfcBalance.f}% : {pfcBalance.c}%</span></div></div></div><div style={{borderTop:"1px solid #ebebea",marginTop:16,paddingTop:14}}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:10}}>PFCãƒãƒ©ãƒ³ã‚¹ï¼ˆ%ï¼‰ä»»æ„å…¥åŠ›</p>{pfcErr&&<p style={{color:"#e63946",fontSize:11,fontWeight:600,marginBottom:8}}>PFCã®åˆè¨ˆãŒ100ã«ãªã‚‹ã‚ˆã†ã«å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚</p>}<div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:10}}>{[{k:"p",l:"P %"},{k:"f",l:"F %"},{k:"c",l:"C %"}].map(x=>(<div key={x.k}><p style={{fontSize:9,color:"#6a6a6a",marginBottom:4}}>{x.l}</p><input type="text" inputMode="decimal" value={pfcPct[x.k]} placeholder="â€”" onChange={e=>setPfcPct(p=>({...p,[x.k]:e.target.value.replace(/[^0-9.]/g,"")}))} style={{...IB,fontSize:13,fontWeight:700,textAlign:"center"}}/></div>))}</div></div></Card>
        </div>)}

        {/* â•â•â•â•â•â• CALC â•â•â•â•â•â• */}
        {tab==="calc"&&(<div className="fu">
          {/* GOAL */}
          <Card style={{marginBottom:14}}><SL>GOAL</SL><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16}}><div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>START DATE</p><input type="date" value={startDate} onChange={e=>setStartDate(e.target.value)} style={{...IB,fontSize:12}}/></div><div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>TARGET DATE</p><input type="date" value={gd} onChange={e=>setGd(e.target.value)} style={{...IB,fontSize:12}}/></div><div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>START WEIGHT</p><div style={{display:"flex",alignItems:"center",gap:8}}><input type="text" inputMode="decimal" value={startWeight} onChange={e=>setStartWeight(e.target.value.replace(/[^0-9.]/g,""))} style={{...IB,width:90,fontSize:18,fontWeight:700,textAlign:"center"}}/><span style={{fontSize:13,color:"#5a5a5a",fontWeight:600}}>kg</span></div></div><div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>TARGET WEIGHT</p><div style={{display:"flex",alignItems:"center",gap:8}}><input type="text" inputMode="decimal" value={gw} onChange={e=>setGw(parseFloat(e.target.value.replace(/[^0-9.]/g,""))||0)} style={{...IB,width:90,fontSize:18,fontWeight:700,textAlign:"center"}}/><span style={{fontSize:13,color:"#5a5a5a",fontWeight:600}}>kg</span></div><p style={{fontSize:12,color:"#3a3a3a",marginTop:8,fontWeight:600}}>æ®‹ã‚Š {Math.abs(W-gw).toFixed(1)} kg ({SW>TW?"æ¸›é‡":SW<TW?"å¢—é‡":"ç¶­æŒ"})</p></div></div><div style={{borderTop:"1px solid #ebebea",paddingTop:14}}><p style={{fontSize:9,letterSpacing:3,color:"#8a8a8a",fontWeight:500,marginBottom:10}}>ç›®æ¨™ãƒšãƒ¼ã‚¹ï¼ˆæ©Ÿæ¢°è¨ˆç®—ï¼‰</p><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>{[{l:"æœˆ",v:`${lossPerMonth} kg/æœˆ`},{l:"é€±",v:`${lossPerWeek} kg/é€±`}].map(p=>(<div key={p.l} style={{background:"#f8f8f6",borderRadius:4,padding:"10px 8px",textAlign:"center"}}><p style={{fontSize:8,color:"#8a8a8a",letterSpacing:2,marginBottom:6}}>{p.l}</p><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a",lineHeight:1.2}}>{p.v}</p></div>))}</div></div></Card>
          {/* CALCULATION MODE */}
          <Card style={{marginBottom:14}}><SL>CALCULATION MODE</SL><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:16}}>{[{id:"auto",l:"AUTO",s:"ISSN/NSCA"},{id:"manual",l:"MANUAL",s:"å…¨æ‰‹å…¥åŠ›"},{id:"semi",l:"SEMI",s:"å¾®èª¿æ•´"}].map(m=>(<div key={m.id} onClick={()=>setCalcMode(m.id)} style={{border:`2px solid ${calcMode===m.id?"#1a1a1a":"#e0e0de"}`,background:calcMode===m.id?"#1a1a1a":"#fff",borderRadius:5,padding:"14px 10px",textAlign:"center",cursor:"pointer"}}><p style={{fontSize:10,letterSpacing:3,fontWeight:700,color:calcMode===m.id?"#fff":"#2a2a2a"}}>{m.l}</p><p style={{fontSize:9,color:calcMode===m.id?"#aaa":"#8a8a8a",marginTop:4}}>{m.s}</p></div>))}</div><div style={{borderTop:"1px solid #ebebea",paddingTop:16}}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:10}}>PFCãƒãƒ©ãƒ³ã‚¹ï¼ˆ%ï¼‰ä»»æ„å…¥åŠ›</p>{pfcErr&&<p style={{color:"#e63946",fontSize:11,fontWeight:600,marginBottom:8}}>PFCã®åˆè¨ˆãŒ100ã«ãªã‚‹ã‚ˆã†ã«å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚</p>}<div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:10}}>{[{k:"p",l:"Protein %"},{k:"f",l:"Fat %"},{k:"c",l:"Carbs %"}].map(x=>(<div key={x.k}><p style={{fontSize:9,color:"#6a6a6a",marginBottom:4}}>{x.l}</p><input type="text" inputMode="decimal" value={pfcPct[x.k]} placeholder="â€”" onChange={e=>setPfcPct(p=>({...p,[x.k]:e.target.value.replace(/[^0-9.]/g,"")}))} style={{...IB,fontSize:13,fontWeight:700,textAlign:"center"}}/></div>))}</div></div></Card>
          {/* PROFILE */}
          <Card style={{marginBottom:14}}><SL>PROFILE</SL><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16}}>{[{l:"èº«é•·(cm)",k:"height"},{l:"å¹´é½¢",k:"age"}].map(f=>(<div key={f.k}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>{f.l}</p><input type="text" inputMode="numeric" value={prof[f.k]} onChange={e=>setProf(p=>({...p,[f.k]:e.target.value.replace(/[^0-9]/g,"")}))} style={{...IB,fontWeight:700}}/></div>))}<div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>æ€§åˆ¥</p><select value={prof.sex} onChange={e=>setProf(p=>({...p,sex:e.target.value}))} style={{...IB}}><option value="male">ç”·æ€§</option><option value="female">å¥³æ€§</option></select></div><div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>ç›®æ¨™</p><select value={prof.goal} onChange={e=>setProf(p=>({...p,goal:e.target.value}))} style={{...IB}}><option value="cut">ã‚«ãƒƒãƒˆ (âˆ’500)</option><option value="maintain">ç¶­æŒ</option><option value="bulk">ãƒãƒ«ã‚¯ (+300)</option><option value="custom">ä»»æ„å…¥åŠ›</option></select></div>{prof.goal==="custom"&&(<div style={{gridColumn:"span 2"}}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>ã‚«ãƒ­ãƒªãƒ¼å¢—æ¸›ï¼ˆkcal/dayï¼‰</p><input type="text" value={prof.goalCustom} placeholder="ä¾‹: -300 or +200" onChange={e=>setProf(p=>({...p,goalCustom:e.target.value}))} style={{...IB,fontWeight:700}}/></div>)}</div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:8}}>æ´»å‹•é‡</p><div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{Object.entries(ACT).map(([k,v])=>(<button key={k} onClick={()=>setProf(p=>({...p,activity:k}))} style={{fontFamily:"'DM Mono',monospace",fontSize:9,letterSpacing:2,padding:"6px 12px",borderRadius:4,border:"2px solid",cursor:"pointer",fontWeight:600,background:prof.activity===k?"#1a1a1a":"#fff",color:prof.activity===k?"#fff":"#2a2a2a",borderColor:prof.activity===k?"#1a1a1a":"#e0e0de"}}>{v.label}</button>))}</div></Card>
          {/* MEAL SET */}
          <Card style={{marginBottom:14}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><SL>é£Ÿäº‹myã‚»ãƒƒãƒˆ</SL><button onClick={()=>setMMealSet(true)} style={{...BS,fontSize:9,letterSpacing:2,padding:"6px 14px",marginTop:-14}}>OPEN</button></div></Card>
          {/* MANUAL */}
          {calcMode==="manual"&&(<Card><SL>MANUAL INPUT</SL><div style={{marginBottom:14,padding:"14px",background:"#f8f8f6",borderRadius:6,border:"1px solid #e8e8e6"}}><p style={{fontSize:11,fontWeight:700,color:"#1a1a1a",marginBottom:10}}>ãƒ¡ã‚¤ãƒ³</p><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12}}>{[{k:"protein",l:"P (g)"},{k:"fat",l:"F (g)"},{k:"carbs",l:"C (g)"}].map(m=>(<div key={m.k}><p style={{fontSize:9,color:"#6a6a6a",marginBottom:4}}>{m.l}</p><input type="text" inputMode="decimal" value={manual[m.k]} onChange={e=>setManual(p=>({...p,[m.k]:e.target.value.replace(/[^0-9.]/g,"")}))} style={{...IB,fontSize:14,fontWeight:700,textAlign:"center"}}/></div>))}</div></div>{manualExtra.map((ex,i)=>(<div key={i} style={{marginBottom:14,padding:"14px",background:"#f8f8f6",borderRadius:6,border:"1px solid #e8e8e6"}}><p style={{fontSize:11,fontWeight:700,color:"#1a1a1a",marginBottom:10}}>{ex.label}</p><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12}}>{[{k:"p",l:"P (g)"},{k:"f",l:"F (g)"},{k:"c",l:"C (g)"}].map(x=>(<div key={x.k}><p style={{fontSize:9,color:"#6a6a6a",marginBottom:4}}>{x.l}</p><input type="text" inputMode="decimal" value={ex[x.k]} placeholder="0" onChange={e=>setManualExtra(prev=>prev.map((r,j)=>j===i?{...r,[x.k]:e.target.value.replace(/[^0-9.]/g,"")}:r))} style={{...IB,fontSize:14,fontWeight:700,textAlign:"center"}}/></div>))}</div></div>))}<div style={{background:"#f4f4f2",borderRadius:4,padding:"14px 16px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}><span style={{fontSize:10,letterSpacing:3,color:"#5a5a5a",fontWeight:600}}>ACTIVE CALORIES</span><span style={{fontSize:26,fontWeight:700,color:"#1a1a1a"}}>{aPFC.calories}<span style={{fontSize:11,color:"#8a8a8a",fontWeight:400,marginLeft:4}}>kcal</span></span></div><p style={{fontSize:11,color:aPFC.calories>tdee?"#e63946":"#2a9d8f",fontWeight:600}}>æ´»å‹•ä»£è¬é‡ã¨ã®å·®åˆ†: {aPFC.calories>tdee?"+":""}{(aPFC.calories-tdee).toFixed(0)} kcal</p></div></Card>)}
          {/* SEMI */}
          {calcMode==="semi"&&(<Card><SL>SEMI-MANUAL</SL><p style={{fontSize:10,color:"#7a7a7a",marginBottom:16,lineHeight:1.6}}>é€šå¸¸ã¯LOCKçŠ¶æ…‹ã§AUTOå€¤ã‚’è¡¨ç¤ºã€‚ä¾‹å¤–çš„ãªé£Ÿäº‹ãŒã‚ã£ãŸå ´åˆã€UNLOCKã—ã¦å®Ÿéš›ã®PFCã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>{semiComputed.map((m,i)=>{const isLk=semiMeals[i].locked;return(<div key={i} style={{marginBottom:14,padding:"14px",background:isLk?"#f8f8f6":"#fffbf0",borderRadius:6,border:`1px solid ${isLk?"#e8e8e6":"#f4a261"}`}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><div><p style={{fontSize:11,fontWeight:700,color:"#1a1a1a"}}>{m.label}</p><p style={{fontSize:8,color:"#8a8a8a",letterSpacing:2}}>{m.labelEn}</p></div><button onClick={()=>setSemiMeals(prev=>prev.map((x,j)=>j===i?{...x,locked:!x.locked}:x))} style={{fontFamily:"'DM Mono',monospace",display:"flex",alignItems:"center",gap:4,fontSize:8,letterSpacing:2,padding:"5px 12px",borderRadius:3,cursor:"pointer",fontWeight:700,background:isLk?"#1a1a1a":"#fff",color:isLk?"#fff":"#f4a261",border:isLk?"2px solid #1a1a1a":"2px solid #f4a261"}}><span>{isLk?"ğŸ”’":"ğŸ”“"}</span>{isLk?"LOCKED":"UNLOCKED"}</button></div><div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8}}>{[{k:"p",l:"P",v:m.cp},{k:"f",l:"F",v:m.cf},{k:"c",l:"C",v:m.cc},{k:"cal",l:"CAL",v:m.cal}].map(x=>(<div key={x.k}><p style={{fontSize:8,color:"#7a7a7a",marginBottom:4,letterSpacing:1}}>{x.l}</p>{x.k==="cal"?(<div style={{...IB,fontSize:14,fontWeight:700,textAlign:"center",padding:"8px 6px",background:"#ebebea",color:"#3a3a3a"}}>{x.v}</div>):(<input type="text" inputMode="decimal" value={isLk?x.v:(semiMeals[i][x.k]||"")} readOnly={isLk} placeholder={String(x.v)} onChange={e=>{if(isLk)return;setSemiMeals(prev=>prev.map((sm,j)=>j===i?{...sm,[x.k]:e.target.value.replace(/[^0-9.]/g,"")}:sm));}} style={{...IB,fontSize:14,fontWeight:700,textAlign:"center",padding:"8px 6px",opacity:isLk?0.5:1,cursor:isLk?"not-allowed":"text"}}/>)}</div>))}</div></div>);})}<div style={{background:"#1a1a1a",borderRadius:6,padding:"16px",marginTop:4}}><p style={{fontSize:8,letterSpacing:4,color:"#8a8a8a",marginBottom:10}}>1æ—¥åˆè¨ˆ</p><div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8}}>{[{l:"CAL",v:semiTotal.calories,u:"kcal"},{l:"P",v:semiTotal.protein,u:"g"},{l:"F",v:semiTotal.fat,u:"g"},{l:"C",v:semiTotal.carbs,u:"g"}].map(x=>(<div key={x.l} style={{textAlign:"center"}}><p style={{fontSize:8,color:"#7a7a7a",marginBottom:4}}>{x.l}</p><p style={{fontSize:20,fontWeight:700,color:"#fff"}}>{x.v}</p><p style={{fontSize:8,color:"#6a6a6a"}}>{x.u}</p></div>))}</div><div style={{marginTop:12,borderTop:"1px solid #3a3a3a",paddingTop:10}}><p style={{fontSize:10,color:semiTotal.calories>tdee?"#ff6b6b":"#6bcf7f",fontWeight:600,textAlign:"center"}}>TDEEå·®åˆ†: {semiTotal.calories>tdee?"+":""}{(semiTotal.calories-tdee).toFixed(0)} kcal</p></div></div></Card>)}
        </div>)}

        {/* â•â•â•â•â•â• SUPPS â•â•â•â•â•â• */}
        {tab==="supps"&&(<div className="fu"><p style={{fontSize:9,letterSpacing:4,color:"#8a8a8a",fontWeight:500,marginBottom:20}}>SUPPLEMENT SCHEDULE</p>{[{k:"pre",l:"PRE-WORKOUT",icon:"â–²",dot:"#1a1a1a"},{k:"during",l:"INTRA-WORKOUT",icon:"â—†",dot:"#5a5a5a"},{k:"post",l:"POST-WORKOUT",icon:"â–¼",dot:"#8a8a8a"},{k:"bed",l:"PRE-BED",icon:"â—",dot:"#b8b8b6"}].map(slot=>(<Card key={slot.k} style={{marginBottom:12}}><div style={{display:"flex",alignItems:"center",gap:10,marginBottom:12}}><span style={{fontSize:12,color:slot.dot}}>{slot.icon}</span><p style={{fontSize:10,letterSpacing:4,color:"#2a2a2a",fontWeight:700}}>{slot.l}</p></div><input value={supps[slot.k]} placeholder="ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..." onChange={e=>setSupps(p=>({...p,[slot.k]:e.target.value}))} style={{...IB,fontSize:12}}/>{slot.k==="bed"&&(<div style={{marginTop:16,borderTop:"1px solid #ebebea",paddingTop:16}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}><div><p style={{fontSize:10,letterSpacing:3,color:"#2a2a2a",fontWeight:700}}>REMINDER</p><p style={{fontSize:11,color:"#7a7a7a",marginTop:3}}>Google Tasks é€£æºï¼ˆäºˆå®šï¼‰</p></div><div onClick={()=>setReminder(!reminder)} style={{width:44,height:26,borderRadius:13,cursor:"pointer",background:reminder?"#1a1a1a":"#d0d0ce",position:"relative",transition:"background .2s"}}><div style={{width:20,height:20,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:reminder?21:3,transition:"left .2s",boxShadow:"0 1px 3px rgba(0,0,0,.25)"}}/></div></div>{reminder&&(<div style={{background:"#f8f8f6",border:"1px solid #e8e8e6",borderRadius:4,padding:"14px 16px"}}><p style={{fontSize:9,letterSpacing:3,color:"#8a8a8a",marginBottom:10}}>REMIND AT</p><input type="time" defaultValue="22:30" style={{...IB,width:"auto",fontSize:18,fontWeight:700}}/></div>)}</div>)}</Card>))}</div>)}

        {/* â•â•â•â•â•â• ADVISOR â•â•â•â•â•â• */}
        {tab==="advisor"&&(<div className="fu"><p style={{fontSize:9,letterSpacing:4,color:"#8a8a8a",fontWeight:500,marginBottom:20}}>ADVISOR â€” ISSN / NSCA</p>
          <Card style={{marginBottom:14}}><SL>ãƒšãƒ¼ã‚¹è¨­å®š</SL><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:14}}><button onClick={()=>setPaceMode("auto")} style={{...BS,background:paceMode==="auto"?"#1a1a1a":"#fff",color:paceMode==="auto"?"#fff":"#3a3a3a",fontSize:9,letterSpacing:2,padding:"10px"}}>ã‚ªãƒ¼ãƒˆï¼ˆBMIé€£å‹•ï¼‰</button><button onClick={()=>setPaceMode("custom")} style={{...BS,background:paceMode==="custom"?"#1a1a1a":"#fff",color:paceMode==="custom"?"#fff":"#3a3a3a",fontSize:9,letterSpacing:2,padding:"10px"}}>ã‚«ã‚¹ã‚¿ãƒ ï¼ˆæ‰‹å‹•ï¼‰</button></div>
            {paceMode==="auto"&&(<div style={{background:"#f8f8f6",borderRadius:4,padding:"12px 14px"}}><p style={{fontSize:9,color:"#7a7a7a",marginBottom:6}}>ç¾åœ¨ã®BMI: <strong style={{color:"#1a1a1a"}}>{calcBMI(W,heightNum).toFixed(1)}</strong></p><p style={{fontSize:9,color:"#7a7a7a"}}>é©ç”¨ãƒšãƒ¼ã‚¹: <strong style={{color:"#1a1a1a"}}>{calcBMI(W,heightNum)>=25?"0.75":"0.50"} kg/é€±</strong><span style={{fontSize:8,color:"#aaa",marginLeft:6}}>({calcBMI(W,heightNum)>=25?"BMIâ‰¥25":"BMI<25"})</span></p></div>)}
            {paceMode==="custom"&&(<div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:8}}>æ–¹å‘</p><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:14}}><button onClick={()=>setCustomDirection("cut")} style={{...BS,fontSize:10,letterSpacing:2,padding:"10px",background:customDirection==="cut"?"#1a1a1a":"#fff",color:customDirection==="cut"?"#fff":"#3a3a3a",borderColor:customDirection==="cut"?"#1a1a1a":"#d0d0ce"}}>æ¸›é‡</button><button onClick={()=>setCustomDirection("bulk")} style={{...BS,fontSize:10,letterSpacing:2,padding:"10px",background:customDirection==="bulk"?"#1a1a1a":"#fff",color:customDirection==="bulk"?"#fff":"#3a3a3a",borderColor:customDirection==="bulk"?"#1a1a1a":"#d0d0ce"}}>å¢—é‡</button></div><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>é€±ã‚ãŸã‚Šå¤‰åŒ–é‡ (kg/é€±)</p><input type="text" inputMode="decimal" value={customPace} onChange={e=>setCustomPace(e.target.value.replace(/[^0-9.]/g,""))} style={{...IB,marginBottom:12}}/><div style={{background:"#f8f8f6",borderRadius:4,padding:"10px 14px"}}><p style={{fontSize:9,color:"#7a7a7a"}}>{customDirection==="cut"?"æ¸›é‡":"å¢—é‡"}æ–¹å‘: START({SW}kg) â†’ {customDirection==="cut"?"-":"+"}{customPace} kg/é€±</p></div></div>)}
          </Card>
          <Card style={{marginBottom:14}}><SL>TREND ANALYSIS</SL><TrendChart chartId="advisor" data={wkD} mode={chart} goalLine={chart==="weight"?weekGoalLine:null} issnLine={chart==="weight"?weekIssnLine:null} showLines={chart==="weight"} showIssn={showIssnLine}/>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,padding:"8px 0",borderTop:"1px solid #ebebea"}}><button onClick={()=>setWeekOffset(o=>o-1)} style={{...BS,fontSize:14,padding:"6px 14px",lineHeight:1}}>â€¹</button><div style={{textAlign:"center"}}><p style={{fontSize:10,fontWeight:700,color:"#1a1a1a"}}>{fmtDS(currentWeek.start)} â€” {fmtDS(currentWeek.end)}</p><p style={{fontSize:8,color:"#8a8a8a",letterSpacing:2,marginTop:2}}>{weekOffset===0?"ä»Šé€±":weekOffset===-1?"å…ˆé€±":`${Math.abs(weekOffset)}é€±å‰`}</p></div><button onClick={()=>{if(weekOffset<0)setWeekOffset(o=>o+1);}} disabled={weekOffset>=0} style={{...BS,fontSize:14,padding:"6px 14px",lineHeight:1,opacity:weekOffset>=0?0.3:1,cursor:weekOffset>=0?"not-allowed":"pointer"}}>â€º</button></div>
            <div style={{display:"flex",gap:4,marginTop:6}}><button onClick={()=>setChart("weight")} style={{...BS,fontSize:8,padding:"4px 10px",background:chart==="weight"?"#1a1a1a":"#fff",color:chart==="weight"?"#fff":"#3a3a3a"}}>ä½“é‡</button><button onClick={()=>setChart("fat")} style={{...BS,fontSize:8,padding:"4px 10px",background:chart==="fat"?"#1a1a1a":"#fff",color:chart==="fat"?"#fff":"#3a3a3a"}}>ä½“è„‚è‚ªç‡</button></div>
            {paceMode==="custom"&&customDirection==="bulk"&&(<div style={{marginTop:12,background:"#fff8e1",border:"1px solid #ffe082",borderRadius:4,padding:"10px 14px"}}><p style={{fontSize:10,color:"#e65100",lineHeight:1.7}}>ISSNã®ç ´ç·šã¯æ¸›é‡ç”¨ã®ç·šã®ãŸã‚ã€å¢—é‡ã«ä½¿ç”¨å‡ºæ¥ã¾ã›ã‚“ã€‚æ¬¡ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚</p></div>)}
          </Card>
          <Card style={{marginBottom:14}}><SL>RECOMMENDATIONS</SL><div style={{display:"flex",alignItems:"center",gap:10,marginBottom:14}}><div style={{width:14,height:14,borderRadius:"50%",background:advice.color==="green"?"#2a9d8f":advice.color==="yellow"?"#f4a261":"#e63946",flexShrink:0}}/><span style={{fontSize:11,fontWeight:700,color:advice.color==="green"?"#2a9d8f":advice.color==="yellow"?"#f4a261":"#e63946"}}>{advice.color==="green"?"ç†æƒ³ãƒšãƒ¼ã‚¹":advice.color==="yellow"?"æ³¨æ„ï¼ˆãƒšãƒ¼ã‚¹éˆåŒ–ï¼‰":"è­¦å‘Šï¼ˆå¤§å¹…é…å»¶ï¼‰"}</span><span style={{fontSize:9,color:"#8a8a8a",marginLeft:"auto"}}>ç›®æ¨™ {getCurrentTargetPace().toFixed(2)} kg/é€±</span></div><div style={{background:"#f8f8f6",borderLeft:`3px solid ${advice.color==="green"?"#2a9d8f":advice.color==="yellow"?"#f4a261":"#e63946"}`,borderRadius:"0 4px 4px 0",padding:"14px 16px"}}><p style={{fontSize:12,color:"#2a2a2a",lineHeight:1.8,fontWeight:500}}>{advice.msg}</p></div>{advice.actualPace!==null&&(<p style={{fontSize:9,color:"#8a8a8a",marginTop:10}}>å®Ÿæ¸¬ãƒšãƒ¼ã‚¹: <strong style={{color:"#1a1a1a"}}>{advice.actualPace.toFixed(3)} kg/é€±</strong></p>)}</Card>
          <Card><SL>CONDITIONING PILLARS</SL><div style={{marginBottom:18}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:6}}><div><span style={{fontSize:10,letterSpacing:2,color:"#1a1a1a",fontWeight:700}}>SLEEP</span><span style={{fontSize:10,color:"#7a7a7a",marginLeft:8}}>ã‚³ãƒ«ãƒã‚¾ãƒ¼ãƒ«æŠ‘åˆ¶ãƒ»GHåˆ†æ³Œæœ€é©åŒ–</span></div><span style={{fontSize:11,color:"#2a2a2a",fontWeight:700,whiteSpace:"nowrap"}}>7/9 hr</span></div><div style={{height:5,background:"#ebebea",borderRadius:3}}><div style={{height:"100%",width:"78%",background:"#1a1a1a",borderRadius:3}}/></div><p style={{fontSize:10,color:"#7a7a7a",marginTop:6}}>â€» Google Fit é€£æºäºˆå®š</p></div><div><div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:6}}><div><span style={{fontSize:10,letterSpacing:2,color:"#1a1a1a",fontWeight:700}}>HI-CARB CYCLE</span><span style={{fontSize:10,color:"#7a7a7a",marginLeft:8}}>ãƒ¬ãƒ—ãƒãƒ³ãƒ»ä»£è¬é©å¿œå¯¾ç­–</span></div><span style={{fontSize:11,color:"#2a2a2a",fontWeight:700,whiteSpace:"nowrap"}}>{hicarbDays}/7</span></div><div style={{height:5,background:"#ebebea",borderRadius:3}}><div style={{height:"100%",width:`${Math.min((hicarbDays/7)*100,100)}%`,background:"#3a3a3a",borderRadius:3}}/></div><button onClick={resetHicarb} style={{...BS,fontSize:9,letterSpacing:2,padding:"5px 10px",marginTop:10}}>ãƒªã‚»ãƒƒãƒˆ</button></div></Card>
        </div>)}
      </main>

      {/* â•â•â•â•â•â• MODALS â•â•â•â•â•â• */}
      {mCloth&&(<Modal onClose={()=>setMCloth(false)}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20}}><div><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a"}}>è¢«æœé‡é‡ãƒ—ãƒªã‚»ãƒƒãƒˆ</p><p style={{fontSize:10,color:"#7a7a7a",marginTop:3}}>ä½“é‡è¨ˆã«ä¹—ã‚‹ã¨ãã«å·®ã—å¼•ãã‚°ãƒ©ãƒ æ•°</p></div><button onClick={()=>setMCloth(false)} style={{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#5a5a5a",lineHeight:1}}>âœ•</button></div>{cloth.map((c,i)=>(<div key={i} style={{marginBottom:16,padding:"14px",background:"#f8f8f6",borderRadius:6,border:"1px solid #ebebea"}}><p style={{fontSize:8,letterSpacing:3,color:"#8a8a8a",fontWeight:500,marginBottom:8}}>ãƒ—ãƒªã‚»ãƒƒãƒˆ {i+1}</p><div style={{display:"flex",gap:8,marginBottom:6}}><input type="text" value={c.name} placeholder="æœè£…ã®åå‰" onChange={e=>setCloth(prev=>prev.map((x,j)=>(j===i?{...x,name:e.target.value}:x)))} style={{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:500,color:"#1a1a1a",background:"#fff",border:"1px solid #e0e0de",borderRadius:4,padding:"7px 10px",flex:3,outline:"none"}}/><div style={{display:"flex",alignItems:"center",gap:4,flex:"0 0 80px"}}><input type="text" inputMode="numeric" value={c.gram} placeholder="ä¾‹:300" onChange={e=>setCloth(prev=>prev.map((x,j)=>(j===i?{...x,gram:e.target.value.replace(/[^0-9]/g,"")}:x)))} style={{fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#1a1a1a",background:"#fff",border:"1px solid #e0e0de",borderRadius:4,padding:"7px 8px",width:"100%",outline:"none",textAlign:"right"}}/><span style={{fontSize:11,color:"#5a5a5a",fontWeight:600}}>g</span></div></div>{c.gram&&(<p style={{fontSize:11,color:"#2a2a2a",fontWeight:600}}>â†’ è¡¨ç¤ºä½“é‡ã‹ã‚‰ <strong style={{color:"#1a1a1a"}}>{(parseInt(c.gram)/1000).toFixed(3)} kg</strong> ã‚’å·®ã—å¼•ã</p>)}</div>))}<button onClick={()=>setMCloth(false)} style={{...BP,width:"100%",padding:"11px",fontSize:10,letterSpacing:3,marginTop:4}}>SAVE & CLOSE</button></Modal>)}

      {mEdit&&editTgt&&(<Modal onClose={()=>setMEdit(false)}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><div><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a"}}>è¨˜éŒ²ã‚’ä¿®æ­£</p><p style={{fontSize:12,color:"#6a6a6a",marginTop:2}}>{editTgt.date}</p></div><button onClick={()=>setMEdit(false)} style={{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#5a5a5a",lineHeight:1}}>âœ•</button></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>{[{l:"ä½“é‡ (kg)",v:editTgt.weight??"",s:v=>setEditTgt(t=>({...t,weight:v}))},{l:"ä½“è„‚è‚ªç‡ (%)",v:editTgt.fat??"",s:v=>setEditTgt(t=>({...t,fat:v}))}].map(f=>(<div key={f.l}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>{f.l}</p><input type="text" inputMode="decimal" value={f.v} onChange={e=>f.s(e.target.value.replace(/[^0-9.]/g,""))} style={{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#1a1a1a",background:"#f8f8f6",border:"1px solid #e0e0de",borderRadius:4,padding:"8px 12px",width:"100%",outline:"none"}}/></div>))}</div><div style={{display:"flex",gap:8}}><button onClick={()=>setMEdit(false)} style={{...BS,flex:1,padding:"10px",fontSize:10,letterSpacing:2}}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button onClick={()=>{record(editTgt.date,editTgt.weight,editTgt.fat,editTgt.hicarb);setMEdit(false);}} style={{...BP,flex:2,padding:"10px",fontSize:10,letterSpacing:3}}>UPDATE</button></div></Modal>)}

      {mCal&&(<Modal onClose={()=>setMCal(false)}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><div><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a"}}>éå»ã®æ—¥ä»˜ã«è¨˜éŒ²</p><p style={{fontSize:10,color:"#7a7a7a",marginTop:3}}>æ—¥ä»˜ã‚’é¸æŠã—ã¦å…¥åŠ›</p></div><button onClick={()=>setMCal(false)} style={{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#5a5a5a",lineHeight:1}}>âœ•</button></div><MiniCal sel={calDate} onSel={ds=>{setCalDate(ds);const ex=data.find(d=>d.date===ds);setCalW(ex?.weight!=null?String(ex.weight):"");setCalF(ex?.fat!=null?String(ex.fat):"");}}/>{calDate&&(<div style={{marginTop:20,borderTop:"1px solid #ebebea",paddingTop:20}}><p style={{fontSize:11,fontWeight:700,color:"#1a1a1a",marginBottom:14}}>{calDate} ã®è¨˜éŒ²</p><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16}}>{[{l:"ä½“é‡ (kg)",v:calW,s:setCalW},{l:"ä½“è„‚è‚ªç‡ (%)",v:calF,s:setCalF}].map(f=>(<div key={f.l}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>{f.l}</p><input type="text" inputMode="decimal" value={f.v} placeholder="â€”" onChange={e=>f.s(e.target.value.replace(/[^0-9.]/g,""))} style={{fontFamily:"'DM Mono',monospace",fontSize:18,fontWeight:700,color:"#1a1a1a",background:"#f8f8f6",border:"1px solid #e0e0de",borderRadius:4,padding:"8px 12px",width:"100%",outline:"none"}}/></div>))}</div><div style={{display:"flex",gap:8}}><button onClick={()=>setMCal(false)} style={{...BS,flex:1,padding:"10px",fontSize:10,letterSpacing:2}}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button onClick={()=>{if(!calW&&!calF)return;record(calDate,calW,calF);setMCal(false);}} style={{...BP,flex:2,padding:"10px",fontSize:10,letterSpacing:3}}>RECORD</button></div></div>)}</Modal>)}

      {mMealSet&&(<Modal onClose={()=>setMMealSet(false)}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a"}}>é£Ÿäº‹myã‚»ãƒƒãƒˆ</p><div style={{display:"flex",gap:8}}><button onClick={()=>{if(mealSets.length>=10)return;setMealSets([...mealSets,{title:"æ–°è¦",meals:JSON.parse(JSON.stringify(EMPTY_MEALS))}]);setCurSetIdx(mealSets.length);}} style={{...BS,fontSize:9,letterSpacing:2,padding:"6px 10px"}}>+ è¿½åŠ </button><button onClick={()=>setMMealSet(false)} style={{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#5a5a5a",lineHeight:1}}>âœ•</button></div></div><div style={{display:"flex",gap:6,marginBottom:16,overflowX:"auto"}}>{mealSets.map((s,i)=>(<button key={i} onClick={()=>setCurSetIdx(i)} style={{...BS,fontSize:9,padding:"6px 12px",whiteSpace:"nowrap",background:curSetIdx===i?"#1a1a1a":"#fff",color:curSetIdx===i?"#fff":"#3a3a3a"}}>{s.title}</button>))}</div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><div style={{flex:1}}><p style={{fontSize:10,color:"#5a5a5a",fontWeight:600,marginBottom:6}}>TITLE</p><input type="text" value={mealSets[curSetIdx].title} onChange={e=>{const n=[...mealSets];n[curSetIdx].title=e.target.value;setMealSets(n);}} style={{...IB}}/></div><button onClick={()=>{setResetTgtIdx(curSetIdx);setMResetConfirm(true);}} style={{...BS,fontSize:9,letterSpacing:2,padding:"6px 10px",marginLeft:10,color:"#d62828",borderColor:"#d62828",marginTop:20}}>é …ç›®ãƒªã‚»ãƒƒãƒˆ</button></div>{mealSets[curSetIdx].meals.map((m,j)=>{const mp=parseFloat(m.p)||0,mf=parseFloat(m.f)||0,mc=parseFloat(m.c)||0;const mCal2=Math.round(mp*4+mf*9+mc*4);return(<div key={j} style={{marginBottom:14,padding:"12px",background:"#f8f8f6",borderRadius:4}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>{m.editable?(<input type="text" value={m.label} onChange={e=>{const n=[...mealSets];n[curSetIdx].meals[j].label=e.target.value;setMealSets(n);}} style={{fontSize:10,fontWeight:600,color:"#1a1a1a",background:"transparent",border:"none",outline:"none",fontFamily:"'DM Mono',monospace"}}/>):(<p style={{fontSize:10,fontWeight:600,color:"#1a1a1a"}}>{m.label}</p>)}<p style={{fontSize:8,color:"#7a7a7a"}}>{m.labelEn}</p></div><textarea value={m.desc} onChange={e=>{const n=[...mealSets];n[curSetIdx].meals[j].desc=e.target.value;setMealSets(n);}} placeholder="é£Ÿäº‹å†…å®¹ï¼ˆæ”¹è¡Œå¯ï¼‰" rows={3} style={{...IB,fontSize:11,minHeight:60,resize:"vertical",marginBottom:8}}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:6}}>{[{k:"p",l:"P (g)"},{k:"f",l:"F (g)"},{k:"c",l:"C (g)"}].map(x=>(<div key={x.k}><p style={{fontSize:9,color:"#6a6a6a",marginBottom:4}}>{x.l}</p><input type="text" inputMode="decimal" value={m[x.k]} placeholder="0" onChange={e=>{const n=[...mealSets];n[curSetIdx].meals[j][x.k]=e.target.value.replace(/[^0-9.]/g,"");setMealSets(n);}} style={{...IB,fontSize:13,fontWeight:700,textAlign:"center"}}/></div>))}</div><div style={{background:"#ebebea",borderRadius:3,padding:"6px 10px",textAlign:"right"}}><span style={{fontSize:10,color:"#5a5a5a"}}>kcal: </span><span style={{fontSize:14,fontWeight:700,color:"#1a1a1a"}}>{mCal2}</span></div></div>);})}<div style={{background:"#1a1a1a",borderRadius:6,padding:"14px 16px",marginBottom:12}}><p style={{fontSize:8,letterSpacing:4,color:"#7a7a7a",marginBottom:8}}>ACTIVE CALORIES (åˆè¨ˆ)</p><div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8}}>{[{l:"CAL",v:mealSetTotals.cal,u:"kcal"},{l:"P",v:mealSetTotals.p,u:"g"},{l:"F",v:mealSetTotals.f,u:"g"},{l:"C",v:mealSetTotals.c,u:"g"}].map(x=>(<div key={x.l} style={{textAlign:"center"}}><p style={{fontSize:8,color:"#7a7a7a"}}>{x.l}</p><p style={{fontSize:18,fontWeight:700,color:"#fff"}}>{Math.round(x.v)}</p><p style={{fontSize:8,color:"#6a6a6a"}}>{x.u}</p></div>))}</div><div style={{marginTop:10,borderTop:"1px solid #3a3a3a",paddingTop:8}}><p style={{fontSize:10,color:mealSetTotals.cal>tdee?"#ff6b6b":"#6bcf7f",fontWeight:600,textAlign:"center"}}>TDEEå·®åˆ†: {mealSetTotals.cal>tdee?"+":""}{(mealSetTotals.cal-tdee).toFixed(0)} kcal</p></div></div><div style={{display:"flex",gap:8,marginTop:16}}><button onClick={()=>{if(mealSets.length<=1)return;setDelTgtIdx(curSetIdx);setMDelConfirm(true);}} disabled={mealSets.length<=1} style={{...BS,flex:1,padding:"10px",fontSize:10,letterSpacing:2,color:mealSets.length<=1?"#aaa":"#d62828",borderColor:mealSets.length<=1?"#ccc":"#d62828",opacity:mealSets.length<=1?0.5:1,cursor:mealSets.length<=1?"not-allowed":"pointer"}}>å‰Šé™¤</button><button onClick={()=>setMMealSet(false)} style={{...BP,flex:2,padding:"10px",fontSize:10,letterSpacing:3}}>SAVE & CLOSE</button></div></Modal>)}

      {mDelConfirm&&(<Modal onClose={()=>setMDelConfirm(false)}><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a",marginBottom:10}}>å‰Šé™¤ç¢ºèª</p><p style={{fontSize:12,color:"#3a3a3a",marginBottom:20}}>ã€Œ{mealSets[delTgtIdx]?.title}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p><div style={{display:"flex",gap:8}}><button onClick={()=>setMDelConfirm(false)} style={{...BS,flex:1,padding:"10px",fontSize:10,letterSpacing:2,color:"#8a8a8a",borderColor:"#ccc"}}>ã„ã„ãˆ</button><button onClick={()=>{const n=[...mealSets];n.splice(delTgtIdx,1);setMealSets(n);setCurSetIdx(0);setMDelConfirm(false);setMMealSet(false);}} style={{...BP,flex:1,padding:"10px",fontSize:10,letterSpacing:3,background:"#d62828"}}>å‰Šé™¤</button></div></Modal>)}

      {mResetConfirm&&(<Modal onClose={()=>setMResetConfirm(false)}><p style={{fontSize:13,fontWeight:700,color:"#1a1a1a",marginBottom:10}}>ãƒªã‚»ãƒƒãƒˆç¢ºèª</p><p style={{fontSize:12,color:"#3a3a3a",marginBottom:20}}>è¨˜å…¥ã—ãŸé …ç›®ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ</p><div style={{display:"flex",gap:8}}><button onClick={()=>setMResetConfirm(false)} style={{...BS,flex:1,padding:"10px",fontSize:10,letterSpacing:2,color:"#8a8a8a",borderColor:"#ccc"}}>ã„ã„ãˆ</button><button onClick={()=>{const n=[...mealSets];n[resetTgtIdx]={title:"",meals:JSON.parse(JSON.stringify(EMPTY_MEALS))};setMealSets(n);setMResetConfirm(false);}} style={{...BP,flex:1,padding:"10px",fontSize:10,letterSpacing:3,background:"#d62828"}}>ãƒªã‚»ãƒƒãƒˆ</button></div></Modal>)}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>

